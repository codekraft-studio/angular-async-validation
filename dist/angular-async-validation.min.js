/**
* Package: angular-async-validation - v0.0.5 
* Description: A multi purpose directive for input async validation 
* Last build: 2017-06-23 
* @author codekraft-studio 
* @license ISC 
*/

angular.module("angular-async-validation",[]),angular.module("angular-async-validation").directive("asyncValidation",["$log","$q","$http","$parse",function($log,$q,$http,$parse){function _link(scope,elem,attrs,ngModel){var validationFunction,validatorName=scope.validatorName?scope.validatorName:"asyncValidator";if(!scope.asyncValidation)return void $log.warn("angular-async-validation: missing or empty argument in async-validation attribute on:",elem);if(ngModel.$options&&ngModel.$options.getOption("debounce")||(ngModel.$options=ngModel.$options.createChild({"*":"$inherit",updateOnDefault:!0,debounce:500})),angular.isObject(scope.asyncValidation)&&angular.forEach(scope.asyncValidation,function(callback,validator){angular.isFunction(callback)&&(ngModel.$asyncValidators[validator]=callback)}),angular.isString(scope.asyncValidation)||angular.isFunction(scope.asyncValidation)){if(angular.isFunction(scope.asyncValidation)&&(validationFunction=scope.asyncValidation),angular.isString(scope.asyncValidation)){if(!_pattern.test(scope.asyncValidation))return void $log.warn("angular-async-validation: You enter a bad callback string:",scope.asyncValidation,"it must contain :value");validationFunction=function(modelValue,viewValue){var value=modelValue||viewValue;if(ngModel.$isEmpty(value))return $q.resolve();var deferred=$q.defer(),url=scope.asyncValidation.replace(":value",value);return $http.get(url,{notifyError:!1}).then(function(response){response.data?deferred.reject():deferred.resolve()},function(){deferred.resolve()}),deferred.promise}}ngModel.$asyncValidators[validatorName]=validationFunction}}var _pattern=new RegExp(":value");return{restrict:"A",require:"ngModel",scope:{asyncValidation:"=",validatorName:"@?"},link:_link}}]);